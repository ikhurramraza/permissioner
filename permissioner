#!/bin/bash

set -euo pipefail

# ================================================================================ #
# ================================ HELPER METHODS ================================ #
# ================================================================================ #

exit_with_error() {
  echo "$1" 1>&2
  exit 1
}

# ================================================================================ #
# ==================================== USAGE ===================================== #
# ================================================================================ #

usage() {
  cat <<HELP
Usage: permissioner MODE DIRECTORY_PATH

ARGUMENTS:
  MODE                    Mode to be used. (Available: basic)
  DIRECTORY_PATH          Path of the directory to recursively apply permissions to.
HELP
}

# ================================================================================ #
# =============================== ARGUMENTS PARSING ============================== #
# ================================================================================ #

if [[ $# -eq 0 ]]; then
  usage
  exit 1
elif [[ $# -eq 1 && $1 == "-h" || $1 == "--help" ]]; then
  usage
  exit 0
elif [[ $# -eq 2 ]]; then
  MODE="$1"
  DIRECTORY_PATH="$2"
  shift 2
else
  usage
  exit 1
fi

# ================================================================================ #
# ==================================== GUARDS ==================================== #
# ================================================================================ #

[[ ! -d "$DIRECTORY_PATH" ]] && exit_with_error "Directory does not exist: $DIRECTORY_PATH"

# ================================================================================ #
# ================================== ENTRYPOINT ================================== #
# ================================================================================ #

case "$MODE" in
basic)
  find "$DIRECTORY_PATH" -type d -exec chmod 755 {} \;
  find "$DIRECTORY_PATH" -type f -exec chmod 644 {} \;
  ;;
*)
  exit_with_error "Unknown mode: $MODE"
  ;;
esac
